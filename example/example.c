#include "libvarintrvv.h"
#include "stdio.h"

#define N 200

int main(void)
{

    // uint8_t compressedData[64] = {0x80, 0x01, 0x81, 0x01, 0x82, 0x01, 0x83, 0x01, 0x84, 0x01, 0x85, 0x01, 0x86, 0x01, 0x87, 0x01, 0x88, 0x01, 0x89, 0x01, 0x8A, 0x01, 0x8B, 0x01, 0x8C, 0x01, 0x8D, 0x01, 0x8E, 0x01, 0x8F, 0x01, 0x90, 0x01, 0x91, 0x01, 0x92, 0x01, 0x93, 0x01, 0x94, 0x01, 0x95, 0x01, 0x96, 0x01, 0x97, 0x01, 0x98, 0x01, 0x99, 0x01, 0x9A, 0x01, 0x9B, 0x01, 0x9C, 0x01, 0x9D, 0x01, 0x9E, 0x01, 0x9F, 0x01};
    // uint8_t compressedData[51] = {0xFE, 0xFD, 0x1D, 0x05, 0x83, 0x35, 0x18, 0xC8, 0x03, 0xE7, 0x56, 0xA9, 0x12, 0x9F, 0x8D, 0xC3, 0x4B, 0xB2, 0x9E, 0x98, 0x0B, 0x96, 0x81, 0xA9, 0x6F, 0xEA, 0x01, 0xE3, 0xDF, 0xD2, 0x8E, 0x02, 0xFD, 0x1A, 0xD9, 0x02, 0x02, 0xEC, 0xE4, 0x02, 0x17, 0xC8, 0x03, 0xA6, 0x05, 0xEA, 0x01, 0xA6, 0x05, 0xD9, 0x02};

    // uint8_t compressedData[51] = {0xFE, 0xFD, 0xFD, 0x05, 0x83, 0x35, 0x18, 0xC8, 0x03, 0xE7, 0x56, 0xA9, 0x12, 0x9F, 0x8D, 0xC3, 0x4B, 0xB2, 0x9E, 0x98, 0x0B, 0x96, 0x81, 0xA9, 0x6F, 0xEA, 0x01, 0xE3, 0xDF, 0xD2, 0x8E, 0x02, 0xFD, 0x1A, 0xD9, 0x02, 0x02, 0xEC, 0xE4, 0x02, 0x17, 0xC8, 0x03, 0xA6, 0x05, 0xEA, 0x01, 0xA6, 0x05, 0xD9, 0x02};

    // uint8_t compressedData[35] = {0x81, 0x82, 0x01, 0x05, 0x03, 0x05, 0x08, 0x0E, 0x0D, 0x0D, 0x05, 0x03, 0x05, 0x08, 0x0E, 0x0D, 0x01, 0x85, 0x03, 0x05, 0xF8, 0x0E, 0x0D, 0x0D, 0xF5, 0x03, 0x05, 0x08, 0x0E, 0x0D, 0x0D, 0x05, 0x03, 0x05, 0x08};

    // uint8_t data[16] = {0x88, 0x84, 0x02, 0x83, 0x81, 0x88, 0x84, 0x02, 0x81, 0x03, 0xF8, 0x84, 0x02, 0x81, 0x03, 0x80};

    uint32_t decompressedData[N];

    uint32_t input_data[N];

    for (int i = 0; i < N; i++)
    {
        input_data[i] = i;
    }

    uint8_t varints[N * 5];

    size_t length = vbyte_encode(input_data, N, varints);

    printf("length %ld \n", length);

    size_t ints_read = varint_decode(varints, length, decompressedData);

    printf("ints processed = %ld length left = %d\n", ints_read, length);

    for (int i = 0; i < ints_read; i++)
    {
        if (decompressedData[i] != input_data[i])
        {
            printf("mismatch at index %ld: got %d expected %d\n", i, decompressedData[i], input_data[i]);
        }
    }

    return 0;
}